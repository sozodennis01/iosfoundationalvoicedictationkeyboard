{"abstract":[{"text":"Optimize token consumption and improve response times by profiling your app’s model usage with Instruments.","type":"text"}],"sections":[],"metadata":{"role":"article","title":"Analyzing the runtime performance of your Foundation Models app","roleHeading":"Article","modules":[{"name":"Foundation Models"}]},"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"text":"Overview","type":"heading"},{"inlineContent":[{"type":"text","text":"Use Instruments to analyze the runtime performance, resource usage, and behavior"},{"type":"text","text":" "},{"text":"of your app. Instruments provides several tools to help you understand how","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"responsive your app is and what kind of power impact it has on the system, as"},{"text":" ","type":"text"},{"type":"text","text":"well as diagnose hitches and more."}],"type":"paragraph"},{"inlineContent":[{"text":"The Foundation Models instrument provides details about the interactions your app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"has with the on-device model, so you can get insight into:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"When the system loads model assets","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"How long it takes to start receiving a response from the model"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"What the token usage is across individual sessions","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Where the model invokes any custom tools your app provides","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"inlineContent":[{"type":"text","text":"The Foundation Models instrument helps you identify exactly where your app spends"},{"text":" ","type":"text"},{"text":"time and uses tokens. By analyzing your app’s model usage patterns, you can","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"identify bottlenecks and apply targeted optimizations to improve responsiveness"},{"text":" ","type":"text"},{"type":"text","text":"and runtime performance."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Use additional instruments — alongside the Foundation Models instrument — to","type":"text"},{"type":"text","text":" "},{"type":"text","text":"understand the impact your model interactions have on thermal state, power, and"},{"type":"text","text":" "},{"type":"text","text":"other system resources."}]},{"level":2,"text":"Launch and configure Instruments for recording","anchor":"Launch-and-configure-Instruments-for-recording","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Start by opening Instruments from your Xcode project:"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"From the Xcode Product menu, choose Profile."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"In the Template Selection window, select the Blank template and click Choose.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Click the “+ Instrument” button in the toolbar to add an instrument.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Search for “Foundation Models” and drag the instrument into your document.","type":"text"}]}]}],"type":"orderedList"},{"type":"paragraph","inlineContent":[{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-template","type":"image"}]},{"type":"paragraph","inlineContent":[{"text":"Before you begin recording a session, consider adding additional instruments that","type":"text"},{"type":"text","text":" "},{"text":"can help you understand the impact your app has on system resources, like Time Profiler,","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"CPU Profiler, and Power Profiler:"}]},{"type":"termList","items":[{"definition":{"content":[{"inlineContent":[{"type":"text","text":"Performs time-based sampling to identify where an app is consuming the most processing time."}],"type":"paragraph"}]},"term":{"inlineContent":[{"text":"Time Profiler","type":"text"}]}},{"term":{"inlineContent":[{"type":"text","text":"CPU Profiler"}]},"definition":{"content":[{"inlineContent":[{"text":"Performs fast, low-overhead measurement of CPU time.","type":"text"}],"type":"paragraph"}]}},{"term":{"inlineContent":[{"text":"Power Profiler","type":"text"}]},"definition":{"content":[{"inlineContent":[{"text":"Performs analysis on the energy consumption across different subsystems.","type":"text"}],"type":"paragraph"}]}}]},{"name":"Note","content":[{"inlineContent":[{"type":"text","text":"Some instruments, like Power Profiler, aren’t available to use with"},{"text":" ","type":"text"},{"text":"Simulator.","type":"text"}],"type":"paragraph"}],"type":"aside","style":"note"},{"type":"paragraph","inlineContent":[{"text":"After you configure your template for analyzing your Foundation Models usage,","type":"text"},{"type":"text","text":" "},{"type":"text","text":"choose File > Save As Template, to make it easier to reuse the same configuration"},{"type":"text","text":" "},{"text":"when launching Instruments.","type":"text"}]},{"text":"Record app interactions to gather data","anchor":"Record-app-interactions-to-gather-data","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before reviewing the performance of your app, first check that your development"},{"text":" ","type":"text"},{"type":"text","text":"device isn’t under thermal pressure or busy with other work. This helps you ensure"},{"type":"text","text":" "},{"type":"text","text":"that the device is in a good performance state, which can influence your analysis."},{"text":" ","type":"text"},{"type":"text","text":"When you record a run, use your app as normal and focus on interactions that"},{"text":" ","type":"text"},{"text":"perform requests to the model. Begin gathering data by clicking the Record Trace","type":"text"},{"type":"text","text":" "},{"type":"text","text":"button on the top left or by choosing File > Record Trace:"}]},{"type":"paragraph","inlineContent":[{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-record","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After you perform actions that generate model responses, wait for the responses"},{"text":" ","type":"text"},{"text":"to complete, then click Stop to end recording.","type":"text"}]},{"type":"heading","level":2,"anchor":"Get-to-know-the-instrument","text":"Get to know the instrument"},{"inlineContent":[{"type":"text","text":"The primary timeline consists of events that the instrument measures. The width of"},{"text":" ","type":"text"},{"type":"text","text":"each component on the timeline indicates latency. The Foundation Models track"},{"text":" ","type":"text"},{"text":"appears in your timeline, with several graphs that provide insight into your","type":"text"},{"type":"text","text":" "},{"text":"session and assets:","type":"text"}],"type":"paragraph"},{"type":"termList","items":[{"definition":{"content":[{"inlineContent":[{"text":"The time the system needs to load model data from storage before fulfilling a request.","type":"text"}],"type":"paragraph"}]},"term":{"inlineContent":[{"text":"Asset Loading","type":"text"}]}},{"definition":{"content":[{"inlineContent":[{"type":"text","text":"The start and end points that reflect the time it takes to perform on overall request."}],"type":"paragraph"}]},"term":{"inlineContent":[{"type":"text","text":"Response"}]}},{"term":{"inlineContent":[{"text":"Inference","type":"text"}]},"definition":{"content":[{"inlineContent":[{"text":"The time the system takes to prepare the generation schema (shown as Prepare Vocabulary), process the input prompt, and compute the output.","type":"text"}],"type":"paragraph"}]}},{"term":{"inlineContent":[{"type":"text","text":"Tool Calling"}]},"definition":{"content":[{"type":"paragraph","inlineContent":[{"text":"The time a tool call occurs and the length of time it takes to perform work.","type":"text"}]}]}}]},{"inlineContent":[{"type":"text","text":"The following image shows the Foundation Models instrument after recording a"},{"type":"text","text":" "},{"type":"text","text":"trace:"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-record-analysis"}],"type":"paragraph"},{"inlineContent":[{"text":"To review what is happening at a more granular level, press Command-Plus Sign to","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"zoom in, or Command-Minus Sign to zoom out of the timeline:"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-timeline"}],"type":"paragraph"},{"text":"Understand token usage","anchor":"Understand-token-usage","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you prompt a language model, the model breaks down the input text into little"},{"text":" ","type":"text"},{"type":"text","text":"fragments called tokens. Each token is typically a word or a piece of a word. The"},{"type":"text","text":" "},{"text":"token count includes instructions, prompts, and outputs for a session instance.","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"If your session processes a large number of tokens that exceed the context window,"},{"text":" ","type":"text"},{"text":"the framework throws the error","type":"text"},{"type":"text","text":" "},{"type":"reference","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/GenerationError/exceededContextWindowSize(_:)","isActive":true},{"type":"text","text":"."},{"text":" ","type":"text"},{"type":"text","text":"For more information on managing the context window size, see"},{"type":"text","text":" "},{"identifier":"doc://com.apple.documentation/documentation/Technotes/tn3193-managing-the-on-device-foundation-model-s-context-window","type":"reference","isActive":true},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"More output tokens generally require more processing time. Additionally, processing"},{"text":" ","type":"text"},{"text":"time depends on the task you perform. For example, summarizing a document requires","type":"text"},{"type":"text","text":" "},{"type":"text","text":"much less processing time than writing a new article, because it’s mostly a reading"},{"type":"text","text":" "},{"text":"task for the model.","type":"text"}]},{"inlineContent":[{"text":"The cost of text varies between characters of symbols versus discrete words. For","type":"text"},{"type":"text","text":" "},{"type":"text","text":"example, the word “Sourdough” might be one token, but a phone number like"},{"type":"text","text":" "},{"text":"+1-(408)-555-0123 might use over ten tokens because of the characters and symbols.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"High token counts affect both initial processing time and memory usage. The","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"Inference detail area shows token metrics for each session. Token counts above"},{"text":" ","type":"text"},{"text":"1000 may slow down response generation, especially on older devices. When you","type":"text"},{"text":" ","type":"text"},{"text":"are testing runtime performance, compare token counts across different app","type":"text"},{"type":"text","text":" "},{"type":"text","text":"interactions to identify which prompts consume the most tokens."}]},{"type":"paragraph","inlineContent":[{"text":"To compare token counts:","type":"text"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Click the Foundation Models instrument."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Select View > Detail Area > Inference."}]}]}],"type":"orderedList"},{"inlineContent":[{"type":"text","text":"The following image shows the details about a single session, including a"},{"text":" ","type":"text"},{"text":"breakdown of where the session spent time:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-inference","type":"image"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"The Inference detail area reveals a breakdown of the session calls during the"},{"type":"text","text":" "},{"type":"text","text":"recorded trace. It also includes:"}],"type":"paragraph"},{"items":[{"definition":{"content":[{"inlineContent":[{"type":"text","text":"The number of events that occur."}],"type":"paragraph"}]},"term":{"inlineContent":[{"type":"text","text":"Count"}]}},{"definition":{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The length of processing time for the session."}]}]},"term":{"inlineContent":[{"text":"Duration","type":"text"}]}},{"definition":{"content":[{"inlineContent":[{"text":"An estimate of the required tokens for the prompt, instructions, tools, and so on.","type":"text"}],"type":"paragraph"}]},"term":{"inlineContent":[{"text":"Max Input Token Count","type":"text"}]}},{"term":{"inlineContent":[{"text":"Max Output Token Count","type":"text"}]},"definition":{"content":[{"inlineContent":[{"type":"text","text":"An estimate of the tokens the model uses for a response."}],"type":"paragraph"}]}}],"type":"termList"},{"inlineContent":[{"text":"For each request, Instruments provides additional details:","type":"text"}],"type":"paragraph"},{"items":[{"definition":{"content":[{"inlineContent":[{"type":"text","text":"Measures how long it takes to prepare the request."}],"type":"paragraph"}]},"term":{"inlineContent":[{"text":"Prompt Processing","type":"text"}]}},{"definition":{"content":[{"inlineContent":[{"text":"Measures how quickly the model begins generating output. A lower first token latency improves perceived responsiveness.","type":"text"}],"type":"paragraph"}]},"term":{"inlineContent":[{"text":"First Token Inference","type":"text"}]}},{"definition":{"content":[{"type":"paragraph","inlineContent":[{"text":"Measures reasoning and verification processing time. A higher latency indicates where the model is spending time “thinking.”","type":"text"}]}]},"term":{"inlineContent":[{"text":"Extended Inference","type":"text"}]}}],"type":"termList"},{"inlineContent":[{"text":"By default, the entire timeline is in a selected state. If you want to focus on","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"a specific time frame to understand more about the performance at a specific point"},{"type":"text","text":" "},{"type":"text","text":"in time, click and drag inside the timeline to select the range you want to analyze,"},{"type":"text","text":" "},{"type":"text","text":"or press Command-Plus Sign to zoom in and Command-Minus Sign to zoom out."}],"type":"paragraph"},{"level":2,"type":"heading","text":"Optimize model loading with prewarming","anchor":"Optimize-model-loading-with-prewarming"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Asset-loading delays appear as gaps between the start of a request and the"},{"type":"text","text":" "},{"type":"text","text":"first token generation. A delay of several hundred milliseconds before tokens"},{"type":"text","text":" "},{"type":"text","text":"start appearing means that your app loads the model after a person makes a request."},{"text":" ","type":"text"},{"type":"text","text":"If you know that your app needs to make a call to the model soon, use the"},{"text":" ","type":"text"},{"type":"reference","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/prewarm(promptPrefix:)","isActive":true},{"text":" method to load the model","type":"text"},{"type":"text","text":" "},{"text":"before you need to call it. Preload the model when you have at least one second","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"before calling a respond method. This technique moves loading time away from the"},{"text":" ","type":"text"},{"type":"text","text":"critical response path to improve the responsiveness of your app."}]},{"syntax":"swift","type":"codeListing","code":["// Create a session.","var session = LanguageModelSession()","","// Prewarm the session when a person navigates to a screen that uses the session.","session.prewarm()"]},{"type":"paragraph","inlineContent":[{"text":"A prompt prefix helps the model prepare for similar requests, reducing the","type":"text"},{"text":" ","type":"text"},{"text":"time to first token. When you know the type of requests a person is about to","type":"text"},{"text":" ","type":"text"},{"text":"make, improve performance by providing a prefix that matches your app’s common","type":"text"},{"type":"text","text":" "},{"text":"prompt patterns. For example, if your app generates itineraries, prewarm the","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"model with the prefix you expect to use for each request:"}]},{"type":"codeListing","syntax":"swift","code":["// Prewarm with context about the likely request.","session.prewarm(promptPrefix: \"Generate a travel itinerary for\")"]},{"inlineContent":[{"text":"After implementing prewarming, profile your app again to verify that asset","type":"text"},{"type":"text","text":" "},{"text":"loading happens before the request is made — eliminating delays in the critical","type":"text"},{"text":" ","type":"text"},{"text":"path.","type":"text"}],"type":"paragraph"},{"text":"Reduce token consumption","type":"heading","anchor":"Reduce-token-consumption","level":2},{"inlineContent":[{"text":"A lower token count improves performance and helps you stay within context limits.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"The ","type":"text"},{"type":"codeVoice","code":"includeSchemaInPrompt"},{"text":" parameter in","type":"text"},{"text":" ","type":"text"},{"isActive":true,"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/streamResponse(generating:includeSchemaInPrompt:options:prompt:)","type":"reference"},{"text":"","type":"text"},{"type":"text","text":" "},{"type":"text","text":"tells the framework to include information about "},{"type":"reference","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Generable","isActive":true},{"type":"text","text":" types in your"},{"text":" ","type":"text"},{"type":"text","text":"prompts before processing the request. Doing so improves the output quality, but"},{"text":" ","type":"text"},{"type":"text","text":"requires that the model consumes more input tokens. If you already made a"},{"type":"text","text":" "},{"type":"text","text":"similar request or provided examples in your system instructions, you can exclude"},{"type":"text","text":" "},{"text":"the schema in subsequent requests. Excluding the schema removes redundant schema","type":"text"},{"text":" ","type":"text"},{"text":"information and can save hundreds of tokens per request. To further optimize","type":"text"},{"type":"text","text":" "},{"text":"token usage, consider whether you need nested ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Generable"},{"text":" types in a parent","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"type. More context is necessary to handle nested "},{"type":"reference","isActive":true,"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Generable"},{"type":"text","text":" schema details."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"When you no longer need the schema data for your session, set "},{"type":"codeVoice","code":"includeSchemaInPrompt"},{"type":"text","text":" "},{"type":"text","text":"to "},{"type":"codeVoice","code":"false"},{"type":"text","text":":"}]},{"type":"codeListing","syntax":"swift","code":["let response = try await session.streamResponse(","    prompt: prompt,","    generable: MyCustomItinerary.self,","    options: .init(includeSchemaInPrompt: false)",")"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"After you make this change, the Inference section of the Foundation Models"},{"text":" ","type":"text"},{"type":"text","text":"instrument displays lower maximum token counts, which translates to faster initial"},{"text":" ","type":"text"},{"type":"text","text":"processing. The following screenshot shows the input token count — with"},{"type":"text","text":" "},{"type":"codeVoice","code":"includeSchemaInPrompt"},{"type":"text","text":" set to "},{"type":"codeVoice","code":"true"},{"text":" — after running three generation","type":"text"},{"text":" ","type":"text"},{"text":"requests:","type":"text"}]},{"type":"paragraph","inlineContent":[{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-1","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The following image shows similar requests, with "},{"type":"codeVoice","code":"includeSchemaInPrompt"},{"text":" set","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"to "},{"code":"false","type":"codeVoice"},{"text":":","type":"text"}]},{"inlineContent":[{"type":"image","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-2"}],"type":"paragraph"},{"level":2,"text":"Verify your optimizations","type":"heading","anchor":"Verify-your-optimizations"},{"type":"paragraph","inlineContent":[{"text":"When you perform runtime optimization updates in your code, profile your app each","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"time to confirm that the changes improve performance. Compare the new timeline with"},{"type":"text","text":" "},{"text":"your previous recordings, and rename each recording from the sidebar based on","type":"text"},{"type":"text","text":" "},{"text":"what changed between runs, to help indicate what the run involved.","type":"text"}]},{"inlineContent":[{"type":"text","text":"Successful prewarming moves asset loading earlier in the timeline and before an"},{"text":" ","type":"text"},{"text":"app makes a request to the model. This reduces the amount of time a session takes","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"to start generating a response to the request and shortens the time an app waits"},{"text":" ","type":"text"},{"text":"to perform additional requests or UI updates. The following image shows a request","type":"text"},{"type":"text","text":" "},{"text":"being made to the model after an app calls ","type":"text"},{"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/prewarm(promptPrefix:)","isActive":true,"type":"reference"},{"type":"text","text":":"}],"type":"paragraph"},{"inlineContent":[{"type":"image","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-verify-changes"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"When you evaluate your app, look for these improvements in each recording:","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"Asset loading happens before the app makes the request.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The first tokens appear immediately after the session starts processing the request."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The Inference detail area shows lower token counts."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"The overall session and tool-calling response times meet the intended user experience."}]}]}]}]}],"seeAlsoSections":[{"title":"Prompting","anchor":"Prompting","generated":true,"identifiers":["doc://com.apple.foundationmodels/documentation/FoundationModels/prompting-an-on-device-foundation-model","doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession","doc://com.apple.foundationmodels/documentation/FoundationModels/Instructions","doc://com.apple.foundationmodels/documentation/FoundationModels/Prompt","doc://com.apple.foundationmodels/documentation/FoundationModels/Transcript","doc://com.apple.foundationmodels/documentation/FoundationModels/GenerationOptions"]}],"identifier":{"interfaceLanguage":"swift","url":"doc://com.apple.foundationmodels/documentation/FoundationModels/analyzing-the-runtime-performance-of-your-foundation-models-app"},"schemaVersion":{"major":0,"minor":3,"patch":0},"variants":[{"paths":["/documentation/foundationmodels/analyzing-the-runtime-performance-of-your-foundation-models-app"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"paths":[["doc://com.apple.documentation/documentation/technologies","doc://com.apple.foundationmodels/documentation/FoundationModels"]]},"kind":"article","references":{"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession":{"kind":"symbol","title":"LanguageModelSession","role":"symbol","type":"topic","abstract":[{"text":"An object that represents a session that interacts with a language model.","type":"text"}],"navigatorTitle":[{"text":"LanguageModelSession","kind":"identifier"}],"url":"/documentation/foundationmodels/languagemodelsession","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"LanguageModelSession","kind":"identifier"}],"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession"},"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/prewarm(promptPrefix:)":{"title":"prewarm(promptPrefix:)","kind":"symbol","role":"symbol","type":"topic","abstract":[{"text":"Loads the resources required for this session into memory, and optionally","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"caches a prefix of your prompt to reduce request latency."}],"url":"/documentation/foundationmodels/languagemodelsession/prewarm(promptprefix:)","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/prewarm(promptPrefix:)","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"prewarm"},{"text":"(","kind":"text"},{"text":"promptPrefix","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","text":"Prompt","preciseIdentifier":"s:16FoundationModels6PromptV"},{"text":"?)","kind":"text"}]},"doc://com.apple.foundationmodels/documentation/FoundationModels/Generable":{"role":"symbol","navigatorTitle":[{"kind":"identifier","text":"Generable"}],"title":"Generable","type":"topic","kind":"symbol","abstract":[{"text":"A type that the model uses when responding to prompts.","type":"text"}],"fragments":[{"text":"protocol","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"Generable"}],"url":"/documentation/foundationmodels/generable","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Generable"},"doc://com.apple.foundationmodels/documentation/FoundationModels/prompting-an-on-device-foundation-model":{"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/prompting-an-on-device-foundation-model","url":"/documentation/foundationmodels/prompting-an-on-device-foundation-model","abstract":[{"text":"Tailor your prompts to get effective results from an on-device model.","type":"text"}],"title":"Prompting an on-device foundation model","kind":"article","role":"article","type":"topic"},"analyzing-the-runtime-performance-of-your-foundation-models-app-timeline":{"type":"image","variants":[{"url":"https://docs-assets.developer.apple.com/published/118cd8356bb67df21df422f0e7fd7293/analyzing-the-runtime-performance-of-your-foundation-models-app-timeline%402x.png","traits":["2x","light"]},{"url":"https://docs-assets.developer.apple.com/published/8253700f496ee116e5ea837e3f5383c4/analyzing-the-runtime-performance-of-your-foundation-models-app-timeline~dark%402x.png","traits":["2x","dark"]}],"alt":"A screenshot of the timeline in Instruments after zooming into the","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-timeline"},"doc://com.apple.documentation/documentation/technologies":{"abstract":[{"type":"text","text":""}],"role":"overview","type":"topic","kind":"technologies","identifier":"doc://com.apple.documentation/documentation/technologies","title":"Technologies","url":"/documentation/technologies"},"analyzing-the-runtime-performance-of-your-foundation-models-app-record-analysis":{"type":"image","alt":"A screenshot of Instruments after recording a session. It shows the timeline","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-record-analysis","variants":[{"traits":["2x","light"],"url":"https://docs-assets.developer.apple.com/published/311c5c444b1dedb67f45d16417464af1/analyzing-the-runtime-performance-of-your-foundation-models-app-record-analysis%402x.png"},{"url":"https://docs-assets.developer.apple.com/published/0364b37fed1e18d27693dd4b419d392d/analyzing-the-runtime-performance-of-your-foundation-models-app-record-analysis~dark%402x.png","traits":["2x","dark"]}]},"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/streamResponse(generating:includeSchemaInPrompt:options:prompt:)":{"url":"/documentation/foundationmodels/languagemodelsession/streamresponse(generating:includeschemainprompt:options:prompt:)","type":"topic","kind":"symbol","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/streamResponse(generating:includeSchemaInPrompt:options:prompt:)","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"text":"streamResponse","kind":"identifier"},{"text":"<","kind":"text"},{"text":"Content","kind":"genericParameter"},{"text":">(","kind":"text"},{"kind":"externalParam","text":"generating"},{"text":": ","kind":"text"},{"text":"Content","kind":"typeIdentifier"},{"text":".Type, ","kind":"text"},{"kind":"externalParam","text":"includeSchemaInPrompt"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:Sb","kind":"typeIdentifier","text":"Bool"},{"kind":"text","text":", "},{"text":"options","kind":"externalParam"},{"kind":"text","text":": "},{"preciseIdentifier":"s:16FoundationModels17GenerationOptionsV","kind":"typeIdentifier","text":"GenerationOptions"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"prompt"},{"text":": () ","kind":"text"},{"kind":"keyword","text":"throws"},{"text":" -> ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:16FoundationModels6PromptV","text":"Prompt"},{"kind":"text","text":") "},{"kind":"keyword","text":"rethrows"},{"kind":"text","text":" -> sending "},{"preciseIdentifier":"s:16FoundationModels20LanguageModelSessionC","kind":"typeIdentifier","text":"LanguageModelSession"},{"kind":"text","text":"."},{"kind":"typeIdentifier","text":"ResponseStream","preciseIdentifier":"s:16FoundationModels20LanguageModelSessionC14ResponseStreamV"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"Content"},{"kind":"text","text":">"}],"role":"symbol","title":"streamResponse(generating:includeSchemaInPrompt:options:prompt:)","abstract":[{"text":"Produces a response stream for a type.","type":"text"}]},"analyzing-the-runtime-performance-of-your-foundation-models-app-template":{"variants":[{"url":"https://docs-assets.developer.apple.com/published/6743063b98571aa8c97ddeb0df398064/analyzing-the-runtime-performance-of-your-foundation-models-app-template%402x.png","traits":["2x","light"]},{"url":"https://docs-assets.developer.apple.com/published/5f2ab0e36af60c25054a9a04f4aa8bbe/analyzing-the-runtime-performance-of-your-foundation-models-app-template~dark%402x.png","traits":["2x","dark"]}],"alt":"A screenshot that shows the Instruments app’s default UI for a blank template,","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-template","type":"image"},"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-2":{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-2","variants":[{"url":"https://docs-assets.developer.apple.com/published/c2fc46ed8f3bafa9afbf743aa8365c7e/analyzing-the-runtime-performance-of-your-foundation-models-app-schema-2%402x.png","traits":["2x","light"]},{"traits":["2x","dark"],"url":"https://docs-assets.developer.apple.com/published/e09487796cc27272c818fc8186305b87/analyzing-the-runtime-performance-of-your-foundation-models-app-schema-2~dark%402x.png"}],"alt":"A screenshot of the detail area that shows information about requests made","type":"image"},"analyzing-the-runtime-performance-of-your-foundation-models-app-record":{"variants":[{"url":"https://docs-assets.developer.apple.com/published/617a8158d453868be06fd695771b6f38/analyzing-the-runtime-performance-of-your-foundation-models-app-record%402x.png","traits":["2x","light"]},{"url":"https://docs-assets.developer.apple.com/published/16ee0d9db6403c1f54b560d69ef56ab7/analyzing-the-runtime-performance-of-your-foundation-models-app-record~dark%402x.png","traits":["2x","dark"]}],"alt":"A screenshot of Instruments that shows the record button in the top left of the","identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-record","type":"image"},"doc://com.apple.foundationmodels/documentation/FoundationModels/GenerationOptions":{"role":"symbol","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/GenerationOptions","abstract":[{"text":"Options that control how the model generates its response to a prompt.","type":"text"}],"url":"/documentation/foundationmodels/generationoptions","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"GenerationOptions"}],"title":"GenerationOptions","kind":"symbol","type":"topic","navigatorTitle":[{"text":"GenerationOptions","kind":"identifier"}]},"doc://com.apple.foundationmodels/documentation/FoundationModels/Prompt":{"fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"Prompt"}],"type":"topic","url":"/documentation/foundationmodels/prompt","abstract":[{"type":"text","text":"A prompt from a person to the model."}],"kind":"symbol","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"Prompt"}],"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Prompt","title":"Prompt"},"doc://com.apple.foundationmodels/documentation/FoundationModels/Instructions":{"type":"topic","role":"symbol","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"Instructions"}],"abstract":[{"type":"text","text":"Details you provide that define the model’s intended behavior on prompts."}],"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Instructions","url":"/documentation/foundationmodels/instructions","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"Instructions","kind":"identifier"}],"title":"Instructions"},"foundation-models-framework-landing-PageImage-card.png":{"alt":"An illustration that represents a foundation model.","variants":[{"traits":["2x","light"],"url":"https://docs-assets.developer.apple.com/published/3b31c20778305122ef5216e67f6a6e33/foundation-models-framework-landing-PageImage-card%402x.png"},{"traits":["2x","dark"],"url":"https://docs-assets.developer.apple.com/published/f16169705bca6cccc271e074fe6ce38d/foundation-models-framework-landing-PageImage-card~dark%402x.png"}],"identifier":"foundation-models-framework-landing-PageImage-card.png","type":"image"},"analyzing-the-runtime-performance-of-your-foundation-models-app-verify-changes":{"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-verify-changes","type":"image","alt":"A screenshot of the timeline in Instruments after zooming into the","variants":[{"url":"https://docs-assets.developer.apple.com/published/bfc4d9fb531e4312903d7019bc746547/analyzing-the-runtime-performance-of-your-foundation-models-app-verify-changes%402x.png","traits":["2x","light"]},{"url":"https://docs-assets.developer.apple.com/published/d0952eb28d65b8473320fedb87910340/analyzing-the-runtime-performance-of-your-foundation-models-app-verify-changes~dark%402x.png","traits":["2x","dark"]}]},"doc://com.apple.documentation/documentation/Technotes/tn3193-managing-the-on-device-foundation-model-s-context-window":{"type":"topic","title":"TN3193: Managing the on-device foundation model’s context window","abstract":[{"text":"Learn how to budget for the context window limit of Apple’s on-device foundation model and handle the error when reaching the limit.","type":"text"}],"url":"/documentation/Technotes/tn3193-managing-the-on-device-foundation-model-s-context-window","kind":"article","role":"article","identifier":"doc://com.apple.documentation/documentation/Technotes/tn3193-managing-the-on-device-foundation-model-s-context-window"},"doc://com.apple.foundationmodels/documentation/FoundationModels/Transcript":{"navigatorTitle":[{"text":"Transcript","kind":"identifier"}],"abstract":[{"type":"text","text":"A linear history of entries that reflect an interaction with a session."}],"kind":"symbol","type":"topic","url":"/documentation/foundationmodels/transcript","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/Transcript","title":"Transcript","role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"text":"Transcript","kind":"identifier"}]},"analyzing-the-runtime-performance-of-your-foundation-models-app-inference":{"alt":"A screenshot of the detail area in Instruments. It shows details about a single","type":"image","variants":[{"url":"https://docs-assets.developer.apple.com/published/b15c566d66da4437c96491356c4d7e7f/analyzing-the-runtime-performance-of-your-foundation-models-app-inference%402x.png","traits":["2x","light"]},{"url":"https://docs-assets.developer.apple.com/published/3948b894579455ddf246b200625ea4ce/analyzing-the-runtime-performance-of-your-foundation-models-app-inference~dark%402x.png","traits":["2x","dark"]}],"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-inference"},"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-1":{"variants":[{"traits":["2x","light"],"url":"https://docs-assets.developer.apple.com/published/91f1f378bba3472565354d5e2f76e6b6/analyzing-the-runtime-performance-of-your-foundation-models-app-schema-1%402x.png"},{"traits":["2x","dark"],"url":"https://docs-assets.developer.apple.com/published/7e77d98a32f4a12503b87ad6a0e17e7a/analyzing-the-runtime-performance-of-your-foundation-models-app-schema-1~dark%402x.png"}],"identifier":"analyzing-the-runtime-performance-of-your-foundation-models-app-schema-1","alt":"A screenshot of the detail area that shows information about requests made","type":"image"},"doc://com.apple.foundationmodels/documentation/FoundationModels":{"url":"/documentation/foundationmodels","identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels","images":[{"type":"card","identifier":"foundation-models-framework-landing-PageImage-card.png"}],"title":"Foundation Models","role":"collection","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"Perform tasks with the on-device model that specializes in language understanding, structured output, and tool calling."}]},"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/GenerationError/exceededContextWindowSize(_:)":{"abstract":[{"type":"text","text":"An error that signals the session reached its context window size limit."}],"identifier":"doc://com.apple.foundationmodels/documentation/FoundationModels/LanguageModelSession/GenerationError/exceededContextWindowSize(_:)","title":"LanguageModelSession.GenerationError.exceededContextWindowSize(_:)","url":"/documentation/foundationmodels/languagemodelsession/generationerror/exceededcontextwindowsize(_:)","role":"symbol","fragments":[{"kind":"keyword","text":"case"},{"kind":"text","text":" "},{"text":"exceededContextWindowSize","kind":"identifier"},{"text":"(","kind":"text"},{"text":"LanguageModelSession","kind":"typeIdentifier","preciseIdentifier":"s:16FoundationModels20LanguageModelSessionC"},{"text":".","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:16FoundationModels20LanguageModelSessionC15GenerationErrorO","text":"GenerationError"},{"text":".","kind":"text"},{"text":"Context","kind":"typeIdentifier","preciseIdentifier":"s:16FoundationModels20LanguageModelSessionC15GenerationErrorO7ContextV"},{"kind":"text","text":")"}],"kind":"symbol","type":"topic"}},"legalNotices":{"copyright":"Copyright &copy; 2026 Apple Inc. All rights reserved.","termsOfUse":"https://www.apple.com/legal/internet-services/terms/site.html","privacyPolicy":"https://www.apple.com/privacy/privacy-policy"}}